<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Keikkalaskuri</title>
  <style>
    :root {
      --bg: #0f0f0f;
      --card: #1a1a1a;
      --card-hover: #232323;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --text: #e5e5e5;
      --text-muted: #a3a3a3;
      --border: #2a2a2a;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }
    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    header { 
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }
    h1 { 
      /* clamp(min, preferred, max) -> min should be smallest */
      font-size: clamp(32px, 5vw, 42px);
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      color: var(--text-muted);
      font-size: clamp(13px, 3vw, 15px);
      line-height: 1.5;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: clamp(20px, 4vw, 28px);
      box-shadow: 0 4px 6px rgba(0,0,0,0.3), 0 1px 3px rgba(0,0,0,0.2);
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .card h2 {
      font-size: 18px;
      margin-bottom: 16px;
      color: var(--text);
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    .grid-3col {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    @media (max-width: 650px) {
      .grid, .grid-3col { 
        grid-template-columns: 1fr;
        gap: 14px;
      }
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.3px;
    }
    input[type=number] {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      color: var(--text);
      transition: all 0.2s ease;
    }
    input[type=number]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    input[type=number]:hover {
      border-color: var(--accent);
    }
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn {
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.2s ease;
      flex: 1;
      min-width: 120px;
    }
    .btn:hover {
      background: linear-gradient(135deg, var(--accent-hover), #7c3aed);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn-secondary {
      background: var(--card-hover);
      border: 1px solid var(--border);
      color: var(--text);
    }
    .btn-secondary:hover {
      background: #2a2a2a;
      border-color: var(--text-muted);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .summary {
      margin-top: 24px;
    }
    .result-card {
      background: var(--card-hover);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border);
      margin-bottom: 16px;
    }
    .line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px dashed var(--border);
      gap: 16px;
    }
    .line:last-child {
      border-bottom: none;
    }
    .line-label {
      color: var(--text-muted);
      font-size: 14px;
      flex: 1;
    }
    .line-value {
      font-weight: 600;
      font-size: 16px;
      white-space: nowrap;
    }
    .line-big .line-value {
      font-size: 20px;
      color: var(--success);
    }
    .line-warning .line-value {
      color: var(--warning);
    }
    .line-danger .line-value {
      color: var(--danger);
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin: 20px 0 12px 0;
      color: var(--text);
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border);
    }
    .highlight {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    .breakdown {
      background: var(--bg);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 13px;
      color: var(--text-muted);
    }
    .breakdown-item .value {
      color: var(--text);
      font-weight: 500;
    }
    footer {
      margin-top: 32px;
      padding-top: 20px;
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
      border-top: 1px solid var(--border);
    }
    @media (max-width: 500px) {
      body { padding: 12px; }
      .btn-group { flex-direction: column; }
      .btn { min-width: 100%; }
    }
    .error {
      color: var(--danger);
      padding: 12px;
      background: rgba(239,68,68,0.06);
      border: 1px solid rgba(239,68,68,0.12);
      border-radius: 8px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Keikkalaskuri</h1>
      <div class="subtitle" style="text-align: center;">Laskuri huomioi kulut suhteutettuna työtunteihin.</div>
    </header>

    <div class="card">
      <h2>Keikkakohtaiset tiedot</h2>
      <div class="grid">
        <div class="input-group">
          <label for="hours">Työtunnit</label>
          <input id="hours" type="number" value="3" step="0.25" min="0">
        </div>
        <div class="input-group">
          <label for="hourly">Tuntihinta (alv 0%)</label>
          <input id="hourly" type="number" value="95" step="1" min="0">
        </div>
        <div class="input-group">
          <label for="distance">Matka yhteensä (km)</label>
          <input id="distance" type="number" value="40" step="1" min="0">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Ajoneuvokulut per kilometri</h2>
      <div class="grid-3col">
        <div class="input-group">
          <label for="fuel">Polttoaine (€/km)</label>
          <input id="fuel" type="number" value="0.12" step="0.01" min="0">
        </div>
        <div class="input-group">
          <label for="insurance">Vakuutukset (€/km)</label>
          <input id="insurance" type="number" value="0.08" step="0.01" min="0">
        </div>
        <div class="input-group">
          <label for="maintenance">Huollot ja korjaukset (€/km)</label>
          <input id="maintenance" type="number" value="0.12" step="0.01" min="0">
        </div>
        <div class="input-group">
          <label for="depreciation">Poistot/rahoitus (€/km)</label>
          <input id="depreciation" type="number" value="0.15" step="0.01" min="0">
        </div>
        <div class="input-group">
          <label for="tires">Renkaat (€/km)</label>
          <input id="tires" type="number" value="0.05" step="0.01" min="0">
        </div>
        <div class="input-group">
          <label for="equipment">Kalustokulumat per keikka (€)</label>
          <input id="equipment" type="number" value="15" step="1" min="0">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Kiinteät kuukausikulut</h2>
      <div class="grid-3col">
        <div class="input-group">
          <label for="monthlyHours">Työtunnit per kuukausi (keskimäärin)</label>
          <input id="monthlyHours" type="number" value="160" step="1" min="1">
        </div>
        <div class="input-group">
          <label for="accounting">Kirjanpito (€/kk)</label>
          <input id="accounting" type="number" value="150" step="10" min="0">
        </div>
        <div class="input-group">
          <label for="rent">Toimisto/varasto (€/kk)</label>
          <input id="rent" type="number" value="300" step="50" min="0">
        </div>
        <div class="input-group">
          <label for="subscriptions">Liittymät ja ohjelmistot (€/kk)</label>
          <input id="subscriptions" type="number" value="80" step="10" min="0">
        </div>
        <div class="input-group">
          <label for="liability">Vastuuvakuutus (€/kk)</label>
          <input id="liability" type="number" value="100" step="10" min="0">
        </div>
        <div class="input-group">
          <label for="marketing">Markkinointi (€/kk)</label>
          <input id="marketing" type="number" value="200" step="50" min="0">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Verot ja vakuutus</h2>
      <div class="grid">
        <div class="input-group">
          <label for="vat">ALV %</label>
          <input id="vat" type="number" value="24" step="1" min="0">
        </div>
        <div class="input-group">
          <label for="yel">YEL-maksu % (yrittäjän eläkevakuutus)</label>
          <input id="yel" type="number" value="24.1" step="0.1" min="0">
        </div>
        <div class="input-group">
          <label for="tax">Tulovero % (yrityksen verot)</label>
          <input id="tax" type="number" value="20" step="1" min="0" max="100">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="btn-group">
        <button class="btn" id="calcBtn">Laske tulos</button>
        <button class="btn btn-secondary" id="resetBtn">Palauta oletukset</button>
      </div>

      <div class="summary" id="summary"></div>
    </div>

    <footer>
      Keikkalaskelma © 2025
    </footer>
  </div>

<script>
/* Helper to format euros */
function formatEuro(n){ 
  if (!isFinite(n)) return '0,00 €';
  return Number(n).toLocaleString('fi-FI', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }) + ' €'; 
}

/* Get elements (explicit, avoids relying on global DOM shortcuts) */
const hoursEl = document.getElementById('hours');
const hourlyEl = document.getElementById('hourly');
const distanceEl = document.getElementById('distance');

const fuelEl = document.getElementById('fuel');
const insuranceEl = document.getElementById('insurance');
const maintenanceEl = document.getElementById('maintenance');
const depreciationEl = document.getElementById('depreciation');
const tiresEl = document.getElementById('tires');
const equipmentEl = document.getElementById('equipment');

const monthlyHoursEl = document.getElementById('monthlyHours');
const accountingEl = document.getElementById('accounting');
const rentEl = document.getElementById('rent');
const subscriptionsEl = document.getElementById('subscriptions');
const liabilityEl = document.getElementById('liability');
const marketingEl = document.getElementById('marketing');

const vatEl = document.getElementById('vat');
const yelEl = document.getElementById('yel');
const taxEl = document.getElementById('tax');

const calcBtn = document.getElementById('calcBtn');
const resetBtn = document.getElementById('resetBtn');
const summary = document.getElementById('summary');

function render(){
  // Read & parse values
  const h = Math.max(0, parseFloat(hoursEl.value) || 0);
  const priceH = Math.max(0, parseFloat(hourlyEl.value) || 0);
  const km = Math.max(0, parseFloat(distanceEl.value) || 0);
  const vatRate = Math.max(0, parseFloat(vatEl.value) || 0);

  // Ajoneuvokulut per km
  const fuelCost = Math.max(0, parseFloat(fuelEl.value) || 0);
  const insuranceCost = Math.max(0, parseFloat(insuranceEl.value) || 0);
  const maintenanceCost = Math.max(0, parseFloat(maintenanceEl.value) || 0);
  const depreciationCost = Math.max(0, parseFloat(depreciationEl.value) || 0);
  const tiresCost = Math.max(0, parseFloat(tiresEl.value) || 0);
  const kmCostTotal = fuelCost + insuranceCost + maintenanceCost + depreciationCost + tiresCost;

  // Kiinteät kk-kulut
  const monthlyH = Math.max(1, parseFloat(monthlyHoursEl.value) || 1);
  const accountingCost = Math.max(0, parseFloat(accountingEl.value) || 0);
  const rentCost = Math.max(0, parseFloat(rentEl.value) || 0);
  const subscriptionsCost = Math.max(0, parseFloat(subscriptionsEl.value) || 0);
  const liabilityCost = Math.max(0, parseFloat(liabilityEl.value) || 0);
  const marketingCost = Math.max(0, parseFloat(marketingEl.value) || 0);
  
  const totalMonthlyCosts = accountingCost + rentCost + subscriptionsCost + liabilityCost + marketingCost;
  const monthlyCostPerHour = totalMonthlyCosts / monthlyH;

  // Kalusto
  const equipmentCost = Math.max(0, parseFloat(equipmentEl.value) || 0);

  // Verot
  const yelRate = Math.max(0, parseFloat(yelEl.value) || 0);
  const taxRate = Math.max(0, parseFloat(taxEl.value) || 0);

  // Basic validations
  if (h <= 0) {
    summary.innerHTML = `<div class="error">Anna työtunnit (vähintään 0.25 h).</div>`;
    return;
  }

  // Laskutus
  const workIncome = h * priceH;
  const vatAmount = workIncome * (vatRate / 100);
  const invoiceWithVat = workIncome + vatAmount;

  // Kulut
  const totalCarCost = km * kmCostTotal;
  const totalFixedCosts = monthlyCostPerHour * h;
  const totalEquipmentCost = equipmentCost;
  const totalCosts = totalCarCost + totalFixedCosts + totalEquipmentCost;

  // Nettotulo ennen veroja ja YEL:iä
  const netBeforeTaxYel = workIncome - totalCosts;

  // YEL-maksu (simple proportional approach) — note: todellisuudessa YEL lasketaan ansiotulosta / ilmoitetusta työtulosta
  const yelAmount = Math.max(0, netBeforeTaxYel * (yelRate / 100));

  // Verotettava tulo
  const taxableIncome = netBeforeTaxYel - yelAmount;
  const taxAmount = Math.max(0, taxableIncome * (taxRate / 100));

  // Käteen jäävä
  const netAfterTax = taxableIncome - taxAmount;

  // Per tunti -laskelmat
  const netPerHour = netAfterTax / h;
  const costsPerHour = totalCosts / h;
  const yelPerHour = yelAmount / h;
  const taxPerHour = taxAmount / h;

  // Kulujakauma per tunti
  const carCostPerHour = totalCarCost / h;
  const fixedCostPerHour = totalFixedCosts / h;
  const equipmentPerHour = totalEquipmentCost / h;

  const euro = formatEuro;

  // Format priceH without euro sign for the small label (show with 2 decimals)
  const priceHLabel = Number(priceH).toLocaleString('fi-FI', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  summary.innerHTML = `
    <div class="result-card">
      <div class="section-title">Laskutus</div>
      <div class="line">
        <div class="line-label">Työtulot (${h} h x ${priceHLabel} €/h)</div>
        <div class="line-value">${euro(workIncome)}</div>
      </div>
      <div class="line">
        <div class="line-label">ALV ${vatRate}%</div>
        <div class="line-value">${euro(vatAmount)}</div>
      </div>
      <div class="line line-big">
        <div class="line-label">Laskutettava summa</div>
        <div class="line-value">${euro(invoiceWithVat)}</div>
      </div>
    </div>

    <div class="result-card">
      <div class="section-title">Kulut yhteensä</div>
      
      <div class="line">
        <div class="line-label">Ajoneuvo (${km} km x ${Number(kmCostTotal).toLocaleString('fi-FI', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €/km)</div>
        <div class="line-value">${euro(totalCarCost)}</div>
      </div>
      <div class="breakdown">
        <div class="breakdown-item"><span>• Polttoaine</span><span class="value">${euro(km * fuelCost)}</span></div>
        <div class="breakdown-item"><span>• Vakuutukset</span><span class="value">${euro(km * insuranceCost)}</span></div>
        <div class="breakdown-item"><span>• Huollot</span><span class="value">${euro(km * maintenanceCost)}</span></div>
        <div class="breakdown-item"><span>• Poistot</span><span class="value">${euro(km * depreciationCost)}</span></div>
        <div class="breakdown-item"><span>• Renkaat</span><span class="value">${euro(km * tiresCost)}</span></div>
      </div>

      <div class="line">
        <div class="line-label">Kiinteät kulut (${h} h x ${Number(monthlyCostPerHour).toLocaleString('fi-FI', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €/h)</div>
        <div class="line-value">${euro(totalFixedCosts)}</div>
      </div>
      <div class="breakdown">
        <div class="breakdown-item"><span>• Kirjanpito</span><span class="value">${euro(accountingCost * h / monthlyH)}</span></div>
        <div class="breakdown-item"><span>• Toimisto/varasto</span><span class="value">${euro(rentCost * h / monthlyH)}</span></div>
        <div class="breakdown-item"><span>• Liittymät</span><span class="value">${euro(subscriptionsCost * h / monthlyH)}</span></div>
        <div class="breakdown-item"><span>• Vastuuvakuutus</span><span class="value">${euro(liabilityCost * h / monthlyH)}</span></div>
        <div class="breakdown-item"><span>• Markkinointi</span><span class="value">${euro(marketingCost * h / monthlyH)}</span></div>
      </div>

      <div class="line">
        <div class="line-label">Kalusto ja tarvikkeet</div>
        <div class="line-value">${euro(totalEquipmentCost)}</div>
      </div>

      <div class="line line-warning">
        <div class="line-label"><strong>Kulut yhteensä</strong></div>
        <div class="line-value"><strong>${euro(totalCosts)}</strong></div>
      </div>
    </div>

    <div class="result-card">
      <div class="section-title">Verot ja maksut</div>
      <div class="line">
        <div class="line-label">Nettotulo ennen YEL:ia ja veroja</div>
        <div class="line-value">${euro(netBeforeTaxYel)}</div>
      </div>
      <div class="line">
        <div class="line-label">YEL-maksu ${yelRate}%</div>
        <div class="line-value">${euro(yelAmount)}</div>
      </div>
      <div class="line">
        <div class="line-label">Verotettava tulo</div>
        <div class="line-value">${euro(taxableIncome)}</div>
      </div>
      <div class="line">
        <div class="line-label">Tulovero ${taxRate}%</div>
        <div class="line-value">${euro(taxAmount)}</div>
      </div>
      <div class="line line-big">
        <div class="line-label"><strong>Käteen jää</strong></div>
        <div class="line-value"><strong>${euro(netAfterTax)}</strong></div>
      </div>
    </div>

    <div class="result-card">
      <div class="section-title">Kulujakauma</div>
      <div class="breakdown">
        <div class="breakdown-item"><span>Ajoneuvokulut</span><span class="value">${euro(carCostPerHour)}/h</span></div>
        <div class="breakdown-item"><span>Kiinteät kulut</span><span class="value">${euro(fixedCostPerHour)}/h</span></div>
        <div class="breakdown-item"><span>Kalusto</span><span class="value">${euro(equipmentPerHour)}/h</span></div>
        <div class="breakdown-item"><span>YEL-maksu</span><span class="value">${euro(yelPerHour)}/h</span></div>
        <div class="breakdown-item"><span>Verot</span><span class="value">${euro(taxPerHour)}/h</span></div>
        <div class="breakdown-item" style="border-top: 1px solid var(--border); padding-top:12px; margin-top:8px; font-weight:600;">
          <span>Kulut yhteensa</span>
          <span class="value">${euro(costsPerHour + yelPerHour + taxPerHour)}/h</span>
        </div>
        <div class="breakdown-item" style="font-weight:700; color:var(--success);">
          <span>Netto</span>
          <span class="value" style="color:${netPerHour > 20 ? 'var(--success)' : netPerHour > 10 ? 'var(--warning)' : 'var(--danger)'};">${euro(netPerHour)}/h</span>
        </div>
      </div>

      <div class="highlight">
        <div class="section-title" style="margin-top:0; border:none;">Lopputulos</div>
        <div class="line" style="border:none; padding-top:0;">
          <div class="line-label" style="font-size:16px; font-weight:600; color:var(--text);">Netto/h</div>
          <div class="line-value" style="font-size:20px; color:${netPerHour > 20 ? 'var(--success)' : netPerHour > 10 ? 'var(--warning)' : 'var(--danger)'};">${euro(netPerHour)}/h</div>
        </div>
        <div class="line" style="border:none; padding-top:8px;">
          <div class="line-label" style="font-size:16px; font-weight:600; color:var(--text);">Netto yhteensä (${h} h)</div>
          <div class="line-value" style="font-size:24px;">${euro(netAfterTax)}</div>
        </div>
      </div>
    </div>
  `;
}

/* Attach event listeners */
calcBtn.addEventListener("click", render);
resetBtn.addEventListener("click", () => {
  // Reset to defaults
  hoursEl.value = 3;
  hourlyEl.value = 95;
  distanceEl.value = 40;

  fuelEl.value = 0.12;
  insuranceEl.value = 0.08;
  maintenanceEl.value = 0.12;
  depreciationEl.value = 0.15;
  tiresEl.value = 0.05;
  equipmentEl.value = 15;

  monthlyHoursEl.value = 160;
  accountingEl.value = 150;
  rentEl.value = 300;
  subscriptionsEl.value = 80;
  liabilityEl.value = 100;
  marketingEl.value = 200;

  vatEl.value = 24;
  yelEl.value = 24.1;
  taxEl.value = 20;

  render();
});

/* Re-render on any input change */
document.querySelectorAll('input').forEach(input => {
  input.addEventListener('input', render);
});

/* Initial render */
render();
</script>

</body>
</html>
